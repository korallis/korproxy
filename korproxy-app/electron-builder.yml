# KorProxy Electron Builder Configuration
# See: https://www.electron.build/configuration/configuration

appId: com.korproxy.app
productName: KorProxy
copyright: Copyright Â© 2024 KorProxy

directories:
  output: release
  buildResources: build

files:
  - dist/**/*
  - dist-electron/**/*
  - package.json

asar: true

# ============================================
# Extra Resources (CLIProxyAPI binaries)
# Platform-specific resources are defined per-platform below
# ============================================

# ============================================
# macOS Configuration
# ============================================
mac:
  category: public.app-category.developer-tools
  icon: build/icon.icns
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  extraResources:
    - from: "resources/binaries/darwin-${arch}/"
      to: "binaries/"
      filter:
        - "**/*"
  # Built-in notarization (electron-builder 24.x+)
  # Uses APPLE_ID and APPLE_APP_SPECIFIC_PASSWORD env vars
  # Set notarize: false locally if you don't have credentials
  notarize: true

  target:
    - target: dmg
      arch:
        - arm64
        - x64
    - target: zip
      arch:
        - arm64
        - x64

dmg:
  iconSize: 80
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications

# ============================================
# Windows Configuration
# ============================================
# NOTE: To remove "Unknown Publisher" warning, you need a Windows Code Signing Certificate
# Set these environment variables for code signing:
#   - WIN_CSC_LINK: Path to .pfx file OR base64-encoded certificate
#   - WIN_CSC_KEY_PASSWORD: Certificate password
# For EV certificates (SSL.com eSigner), use custom sign hook
# See: https://www.electron.build/code-signing
win:
  icon: build/icon.ico
  # Sign all executables
  signingHashAlgorithms:
    - sha256
  # Use timestamp server for long-term validity
  timeStampServer: http://timestamp.digicert.com
  extraResources:
    - from: "resources/binaries/win32-${arch}/"
      to: "binaries/"
      filter:
        - "**/*"
  target:
    - target: nsis
      arch:
        - x64
    - target: zip
      arch:
        - x64

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false
  createDesktopShortcut: true
  createStartMenuShortcut: true
  artifactName: "${productName}-${version}-setup.${ext}"

# ============================================
# Linux Configuration
# ============================================
linux:
  icon: build/icon.png
  category: Development
  extraResources:
    - from: "resources/binaries/linux-${arch}/"
      to: "binaries/"
      filter:
        - "**/*"
  target:
    - target: AppImage
      arch:
        - x64
    - target: deb
      arch:
        - x64
  maintainer: KorProxy <support@korproxy.com>
  synopsis: AI Proxy Manager for Claude, Gemini, and OpenAI
  description: >
    KorProxy allows you to manage and use your existing AI provider
    subscriptions with various AI coding tools and applications.

# ============================================
# Publishing Configuration
# ============================================
publish:
  provider: github
  owner: korallis
  repo: korproxy
  releaseType: release

# ============================================
# Artifact Naming
# ============================================
artifactName: "${productName}-${version}-${os}-${arch}.${ext}"

# ============================================
# After Sign Hook (for notarization)
# ============================================
afterSign: scripts/notarize.cjs
